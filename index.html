<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Carte avec points</title>
    <!-- Inclure Leaflet CSS et JavaScript -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        #map { height: 600px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([45.7516852, 4.9162884], 13); // Initialiser la carte avec un centre et un zoom

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Récupérer les données depuis le fichier JSON généré côté serveur
        fetch('http://localhost:8000/dataSort.php')
            .then(response => response.json())
            .then(data => {
                let i = 0; 
                var colorIcon;
 
                // Pour avoir un morceau
                // Object.keys(data).slice(200,250).forEach(rue => {
                // Utilisation de l'icône personnalisée pour chaque marqueur
                Object.values(data).forEach(group => {
                    i+=1;
                    // Juste pour avoir une couleur qui dérive avec le nombre
                    colorIcon = L.divIcon({
                        className: 'custom-div-icon',
                        html: "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgb(" + (0+(i)) + ", 100, 90)' width='48px' height='48px'><path d='M12 0C7 0 3 4 3 9c0 7 9 15 9 15s9-8 9-15c0-5-4-9-9-9zm-1.5 13l-3.5-3.5 1.5-1.5 2 2 4-4 1.5 1.5-5.5 5.5z'/></svg>",
                        iconSize: [48, 48],
                        iconAnchor: [24, 48],
                        popupAnchor: [0, -48]
                    });
                    
                    group.forEach(point => {

                        let latitude = point.Lat;
                        let longitude = point.Long;
                        var marker = L.marker([latitude, longitude], {icon: colorIcon}).addTo(map);
                        marker.bindPopup(
                            'Adresse: ' + point.adresse +
                            '<br>Nombre: ' + point.nombre +
                            '<br>coord: ' + point.coordinate
                        );
                    })
                });
                
                // Object.keys(data).forEach(rue => {
                //     i+=1;
                //     // Juste pour avoir une couleur qui dérive avec le nombre
                //     colorIcon = L.divIcon({
                //         className: 'custom-div-icon',
                //         html: "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgb(" + (50+(i/5)) + ", 50, 90)' width='48px' height='48px'><path d='M12 0C7 0 3 4 3 9c0 7 9 15 9 15s9-8 9-15c0-5-4-9-9-9zm-1.5 13l-3.5-3.5 1.5-1.5 2 2 4-4 1.5 1.5-5.5 5.5z'/></svg>",
                //         iconSize: [48, 48],
                //         iconAnchor: [24, 48],
                //         popupAnchor: [0, -48]
                //     });
                //     data.forEach(point => {
                //         console.log(point);
                //     })
                //     data[rue].forEach(point => {
                //         let latitude = point.coordinate[1];
                //         let longitude = point.coordinate[0];
                //         var marker = L.marker([latitude, longitude], {icon: colorIcon}).addTo(map);
                //         marker.bindPopup(
                //             'Adresse: ' + point.adresse +
                //             '<br>Nombre: ' + point.nombre +
                //             '<br>coord: ' + point.coordinate);
                //     });
                // });

            });
    </script>
</body>
</html>
